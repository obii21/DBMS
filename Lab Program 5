CREATE DATABASE COMPANY;
USE COMPANY;

CREATE TABLE DEPARTMENT(DNO INT(5) PRIMARY KEY, DNAME VARCHAR(10), MGRSSN VARCHAR(10),
MGRSTARTDATE DATE);

CREATE TABLE EMPLOYEE(SSN VARCHAR(10) PRIMARY KEY, NAME VARCHAR(10), ADDRESS VARCHAR(15),
SEX VARCHAR(4), SALARY DOUBLE, SUPERSSN VARCHAR(10), DNO INT(5),FOREIGN KEY(SUPERSSN) REFERENCES
EMPLOYEE(SSN),FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNO));

ALTER TABLE DEPARTMENT ADD FOREIGN KEY(MGRSSN) REFERENCES EMPLOYEE(SSN);

CREATE TABLE DLOCATION(DNO INT(5), DLOC VARCHAR(15), PRIMARY KEY(DNO,DLOC), FOREIGN KEY(DNO)
REFERENCES DEPARTMENT(DNO));

CREATE TABLE PROJECT(PNO INT(5) PRIMARY KEY, PNAME VARCHAR(10), PLOC VARCHAR(10), DNO
INT(5), FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNO) ON DELETE CASCADE);

CREATE TABLE WORKS_ON(SSN VARCHAR(10), PNO INT(5), HOURS INT, PRIMARY KEY(SSN,PNO), FOREIGN
KEY(SSN) REFERENCES EMPLOYEE(SSN) ON DELETE CASCADE, FOREIGN KEY(PNO) REFERENCES PROJECT(PNO) ON
DELETE CASCADE);

DESC EMPLOYEE;
DESC DEPARTMENT;
DESC DLOCATION;
DESC PROJECT;
DESC WORKS_ON;

INSERT INTO EMPLOYEE(SSN,NAME,ADDRESS,SEX,SALARY)
VALUES('W101','SCOTT','BANGALORE','M',25000);
INSERT INTO EMPLOYEE(SSN,NAME,ADDRESS,SEX,SALARY)
VALUES('W102','SMITH','MYSORE','M',15000);
INSERT INTO EMPLOYEE(SSN,NAME,ADDRESS,SEX,SALARY)
VALUES('M102','JOHN','MANGALORE','M',600000);
INSERT INTO EMPLOYEE(SSN,NAME,ADDRESS,SEX,SALARY)
VALUES('M101','KATE','MANGALORE','F',650000);

INSERT INTO DEPARTMENT VALUES(01,'SALES','W101',20001002);
INSERT INTO DEPARTMENT VALUES(02,'ACCOUNT','W102',19901002);
INSERT INTO DEPARTMENT VALUES(03,'ACCOUNT','M102',19900503);
INSERT INTO DEPARTMENT VALUES(04,'SALES','M101',19990503);

INSERT INTO DLOCATION VALUES(01, 'WHITEFILED');
INSERT INTO DLOCATION VALUES(02, 'HOODI');
INSERT INTO DLOCATION VALUES(03, 'RAJAJINAGAR');
INSERT INTO DLOCATION VALUES(04, 'KORMANGALA');

INSERT INTO PROJECT VALUES(301,'IOT', 'USA', 01);
INSERT INTO PROJECT VALUES(302,'IOT', 'USA', 02);
INSERT INTO PROJECT VALUES(303,'CC', 'UK', 03);
INSERT INTO PROJECT VALUES(304,'ML', 'UK', 04);

INSERT INTO WORKS_ON VALUES('W101',301,12);
INSERT INTO WORKS_ON VALUES('W102',302,10);
INSERT INTO WORKS_ON VALUES('M101',303,17);
INSERT INTO WORKS_ON VALUES('M102',304,14);

UPDATE EMPLOYEE SET SUPERSSN = 'W102',DNO = 1 WHERE SSN = 'W101';
UPDATE EMPLOYEE SET SUPERSSN = 'M101',DNO = 2 WHERE SSN = 'W102';
UPDATE EMPLOYEE SET SUPERSSN = 'M101',DNO = 3 WHERE SSN = 'M102';
UPDATE EMPLOYEE SET SUPERSSN = NULL,DNO = 4 WHERE SSN = 'M101';

SELECT * FROM EMPLOYEE;
SELECT * FROM DEPARTMENT;
SELECT * FROM DLOCATION;
SELECT * FROM PROJECT;
SELECT * FROM WORKS_ON;

(SELECT PNO FROM PROJECT P,DEPARTMENT D,EMPLOYEE E WHERE P.DNO=D.DNO AND E.SSN=D.MGRSSN
AND E.NAME='SCOTT')
UNION
(SELECT PNO FROM EMPLOYEE E,WORKS_ON W WHERE E.SSN=W.SSN AND E.NAME='SCOTT');

SELECT E.SSN,SALARY*1.1 FROM EMPLOYEE E, WORKS_ON W, PROJECT P WHERE E.SSN=W.SSN AND
W.PNO=P.PNO AND PNAME='IOT';

SELECT DNAME, MAX(SALARY), MIN(SALARY), AVG(SALARY) FROM EMPLOYEE E, DEPARTMENT D WHERE
E.DNO=D.DNO AND D.DNAME='ACCOUNT';

SELECT E.NAME FROM EMPLOYEE E WHERE NOT EXISTS (SELECT PNO FROM PROJECT WHERE DNO=4 AND
PNO NOT IN (SELECT PNO FROM WORKS_ON W WHERE W.SSN=E.SSN));

SELECT DNO, COUNT(SSN) FROM EMPLOYEE 
WHERE SALARY > 600000 AND DNO IN (SELECT DNO FROM EMPLOYEE GROUP BY DNO HAVING COUNT(SSN) > 0)
GROUP BY DNO;
